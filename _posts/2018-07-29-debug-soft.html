---
layout: default
title: 软件调试
---

<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>软件调试</title>
<link href="../Media/style/main.css" rel="stylesheet" type="text/css">
<style type="text/css">
.ul-padding-left {
	padding-left: 4em;
}
</style>
</head>
<body>
<h1>软件调试</h1>
<p>软件调试在软件开发中占有很大比重，有时候调试比写代码占用了更多的时间。软件项目的延期大多不是因为功能需求没有完全实现，而是到了deadline还存在很多Bug需要调试解决，这让软件团队的大部分人加班，十分痛苦。软件调试的目的多是为了确保业务流程正确、发现软件的性能瓶颈、定位并解决软件的Bug等。本文主要讲几种定位Bug的常用方式，解决了定位Bug这个最核心、最难的问题，接着对Bug对症下药就有Bug的解决方案了。</p>
<p><b>先确定Bug对应的软件和代码版本，再进行调试分析解决。</b></p>
<h2>直觉和想象</h2>
<p>当遇到一个Bug的时候，依靠自己的直觉和想象定位可能出现Bug的原因，在脑海中对可能造成Bug的代码进行静态分析，找出Bug的根因并给出解决方案。</p>
<p>这个方法算是一个神级操作，看起来什么都没有做就把问题解决了。通常这需要你对软件代码足够的熟悉，能在脑海中模拟软件的执行过程。只能用来解决你自己编写代码，或者你深度阅读过的代码。</p>
<p>脑海中对代码进行静态分析的能力，可以通过大量阅读代码，大脑持续模拟软件执行来加强。</p>
<h2>Code Review</h2>
<p>Code Review（代码审查）略逊于直觉和想象的方式，用于处理你不太熟悉的代码：别人写的、时间长了记不清的代码。打开开发工具查看代码，结合Bug现象分析，确定Bug的原因。</p>
<p>如果早期进行了比较好的Code Review，可以减少很多不必要的Bug，事半功倍，软件发布后就省下很多解决Bug时间。</p>
<h2>断点调试</h2>
<p>断点调试可以一步一步的查看软件的执行过程，直接定位到Bug的代码位置。</p>
<p>断点调试是比较常用的调试方式，十分有效，对学习编程有很大好处。但是也有不少缺点：基本上只能在开发环境上断点调试；调试的上下文是一次性的，不能保存，如果需要只能进行二次调试；当项目较大时断点调试可能需要花费大量的时间。</p>
<p>对于偶发性的Bug，断点调试不知道需要调试多少遍才能定位大Bug的原因。</p>
<h2>日志调试</h2>
<p>日志记录下软件的执行过程，能直接记录Bug发生的原因，可以供程序员进行分析。</p>
<p>日志记录在开发环境和生产环境同样有效。日志记录的是持久化内容，可以多次查看、共享（邮件发送）等。更好的日志可以通过软件读取日志记录数据，作为软件的输入数据再次模拟软件运行，重新复现Bug，可结合断点调试找到产生Bug的原因。</p>
<p>我曾排斥为软件增加日志，原因是浪费性能、破坏代码的优美，最终还是妥协了，优点就是上面讲的。浪费性能是必然的，尤其是输出比较多的详细日志，可以通过设置日志的等级，减少或增加日志记录；代码的优美只能适当的破坏了，当然拥有良好的代码风格也不会写出太难看的代码。</p>
<h2>模拟生产环境</h2>
<p>生产环境中的Bug，受限于生产环境，不能在生产环境中接直调进行试代码，这时需使用构造生产环境的条件进行模拟复现。用最小的成本和时间定位到软件问题并及时处理。模拟输入数据、监测软件执行过程、核对输出结果基本能定位到问题原因。构造的条件可能要构造多种情况，才能确定和生产环境中条件一致那种情况。有点类似单元测试的过程，但是范围更广，可能涉及到多个方法、模块、多个网络终端运行的进程。</p>
<h2>调试工具</h2>
<p>调试工具是采用一些辅助工具进行调试，用不编程的方式发现和解决软件Bug。
<ul class="ul-padding-left">
  <li>CPU</li>
  查看软件中哪些代码消耗较多的CPU。一个模块的具体函数在所监测时间段内执行次数、占用的CPU百分比、时钟周期等。对占用CPU较多的代码进行优化、重构、重写，更加有效地使用CPU，在CPU占用量和效率间找个平衡点。
  <li>内存</li>
  查看软件的哪些模块占用了较多的内存。一个模块创建了哪些比较占用内存数据、内存数据的生命周期。对占用内存较多代码的进行优化、重构、重写。尽量减少创建内存数据、缩短内存数据的生命周期，使软件占用更少的内存能同样实现业务。
  <li>数据访问</li>
  数据访问的一般是输入、文件、数据库存储等，程序读取数据经过处理展示给用户。访问数据的不同方式，存在很大的性能差异，即使是同一种方式，程序代码的不同写法也可能存在很大的性能差异。可以采用减少数据的访问次数、控制加载数据量大小、条件筛下移到数据层处理等。工具软件可以查看每次的数据访问信息、耗时、获取数据的大小、相同访问的访问次数等，进而对数据访问进行优化。如果仍然达不到性能要求，可以考虑更换数据的存储方式。
  <li>系统工具</li>
  运行在一个平台上的软件，平台的系统或者系统工具有时会记录软件Bug包的相关信息，确定软件Bug在该平台上出现的原因,针对平台进行解决。
</ul>
</p>
<p><a href="/2018/06/01/csharp-development-common-tools.html">C# 开发常用工具</a>中提及了一部分工具。</p>
<h2>总结</h2>
<p>以上是软件生命周期中，几种比较常用的调试方式，不同的场景下采用不同的调试方式或组合。如果方法使用得当，一般人需要几个小时甚至几天才能解决的Bug，你只需要花比较少的时间就能够解决了，游刃有余。</p>
</body>
</html>
